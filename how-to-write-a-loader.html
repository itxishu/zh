<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta name="description" content="">
		<meta name="author" content="">
		<link rel="icon" type="image/png" href="/assets/favicon.png" />
		<link rel="stylesheet" href="css/doc.css" />
		<title>how to write a loader</title>
	</head>
	<body>
		<script src="js/doc.js" charset="utf-8" async></script>
		<div class="container">
			<div class="row">
				<div class="col-md-3 nav">

					<div class="logo">
	<ul class="cube-inner">
		<li class="front"><li class="back"><li class="right"><li class="left"><li class="top"><li class="bottom">
	</ul>
	<ul class="cube">
		<li class="front"><li class="back"><li class="right"><li class="left"><li class="top"><li class="bottom">
		<li class="floor">
	</ul>
</div>
<div class="name">webpack</div>
<div class="tagline">MODULE BUNDLER</div>


					<div class="sidebar">
						<ul><li><a href=".">Home</a></li></ul>
						<ul>
<li>Getting Started<ul>
<li><a href="motivation.html">Motivation</a></li>
<li><a href="what-is-webpack.html">What is webpack?</a></li>
<li><a href="installation.html">Installation</a></li>
<li><a href="usage.html">Usage</a></li>
<li>Require Modules</li>
<li>Vendor Modules</li>
<li><a href="using-loaders.html">Using Loaders</a></li>
<li><a href="using-plugins.html">Using Plugins</a></li>
<li><a href="dev-tools.html">Dev Tools</a></li>
<li><a href="troubleshooting.html">Troubleshooting</a></li>
</ul>
</li>
<li>Tutorials and examples<ul>
<li><a href="http://webpack.github.io/docs/tutorials/getting-started/">Getting started</a></li>
<li><a href="list-of-tutorials.html">List of tutorials</a></li>
<li><a href="examples.html">examples</a></li>
</ul>
</li>
<li>Guides<ul>
<li><a href="commonjs.html">CommonJs</a></li>
<li><a href="amd.html">AMD</a></li>
<li><a href="webpack-for-browserify-users.html">webpack for browserify users</a></li>
<li><a href="code-splitting.html">Code Splitting</a></li>
<li><a href="stylesheets.html">Stylesheets</a></li>
<li><a href="optimization.html">Optimization</a></li>
<li><a href="long-term-caching.html">Long-term Caching</a></li>
<li><a href="how-to-write-a-loader.html">How to write a loader</a></li>
<li><a href="how-to-write-a-plugin.html">How to write a plugin</a></li>
<li><a href="multiple-entry-points.html">Multiple entry points</a></li>
<li><a href="library-and-externals.html">Library and externals</a></li>
<li><a href="shimming-modules.html">Shimming modules</a></li>
<li><a href="testing.html">Testing</a></li>
<li><a href="build-performance.html">Build performance</a></li>
<li><a href="hot-module-replacement-with-webpack.html">Hot Module Replacement with webpack</a></li>
<li><a href="comparison.html">Comparison</a></li>
</ul>
</li>
<li>webpack with<ul>
<li><a href="usage-with-grunt.html">grunt</a></li>
<li><a href="usage-with-gulp.html">gulp</a></li>
<li><a href="usage-with-bower.html">bower</a></li>
<li><a href="usage-with-karma.html">karma</a></li>
</ul>
</li>
<li>Lists<ul>
<li><a href="loader-conventions.html">loader conventions</a></li>
<li><a href="list-of-loaders.html">List of loaders</a></li>
<li><a href="list-of-plugins.html">List of plugins</a></li>
<li><a href="list-of-tutorials.html">List of tutorials</a></li>
<li><a href="list-of-hints.html">List of hints</a></li>
</ul>
</li>
<li>API<ul>
<li><a href="configuration.html">Configuration</a></li>
<li><a href="cli.html">CLI</a></li>
<li><a href="node.js-api.html">Node.js API</a></li>
<li><a href="api-in-modules.html">API in modules</a></li>
<li><a href="loaders.html">Loaders</a></li>
<li><a href="plugins.html">Plugins</a></li>
<li><a href="context.html">Context</a></li>
<li><a href="resolving.html">Resolving</a></li>
<li><a href="hot-module-replacement.html">Hot Module Replacement</a></li>
<li>Dev Tools<ul>
<li><a href="webpack-dev-server.html">webpack-dev-server</a></li>
<li><a href="webpack-dev-middleware.html">webpack-dev-middleware</a></li>
</ul>
</li>
</ul>
</li>
<li>Development<ul>
<li><a href="changelog.html">Changelog</a></li>
<li><a href="roadmap.html">Roadmap</a></li>
<li><a href="ideas.html">Ideas</a></li>
<li>Contributing</li>
</ul>
</li>
</ul>

					</div>
				</div>

				<div class="col-md-9">
					<!--<div class="announcement">
						<div class="announcement-inner">
							<em>2014-07-04</em> Help to improve webpack by filling out <a href="https://docs.google.com/forms/d/101ZcujnVL8l575T6VRl62SfrVj5FZC1IzwMH1258GVc/viewform">this little survey</a>. Thanks!<br>
							<em>2015-03-04</em> You can now comment doc pages (on the bottom of the page). Free feel to add comments about missing/unclear stuff or fix stuff that other people find unclear. You can use the Edit button on the top right corner.
						</div>
					</div>-->

					<div class="pull-right">
						<a href="https://github.com/webpack/docs/wiki/how-to-write-a-loader/_edit" class="wikieditlink">Edit</a>
					</div>
					<div class="row">
						<div class="col-md-12 page-header">
							<h1 id="wikititle">how to write a loader</h1>
						</div>
					</div>

					<div class="row">
						<div id="wiki" class="col-md-12">
							<div class="contents"><ul><li><a href="#examples">Examples</a></li><li><a href="#guidelines">Guidelines</a><ul><li><a href="#do-only-a-single-task">do only a single task</a></li><li><a href="#generate-modules-that-are-modular">generate modules that are modular</a></li><li><a href="#flag-itself-cacheable-if-possible">flag itself cacheable if possible</a></li><li><a href="#not-keep-state-between-runs-and-modules">not keep state between runs and modules</a></li><li><a href="#mark-dependencies">mark dependencies</a></li><li><a href="#resolve-dependencies">resolve dependencies</a></li><li><a href="#extract-common-code">extract common code</a></li><li><a href="#should-not-embed-absolute-paths">should not embed absolute paths</a></li><li><a href="#use-a-library-as-peerdependencies-when-they-wrap-it">use a library as <code>peerDependencies</code> when they wrap it</a></li><li><a href="#programmable-objects-as-query-option">programmable objects as <code>query</code>-option</a></li><li><a href="#be-added-to-the-list-of-loaders">be added to the <a href="list-of-loaders.html">list of loaders</a></a></li></ul></li><li><a href="#read-more">Read more</a></li></ul></li></ul></div><p>A loader is a node module exporting a <code><span class="function"><span class="keyword">function</span></span></code>.</p>
<p>This function is called when a resource should be transformed by this loader.</p>
<p>In the simple case, when only a single loader is applied to the resource, the loader is called with one parameter: the content of the resource file as string.</p>
<p>The loader can access the <a href="loaders.html">loader API</a> on the <code><span class="keyword">this</span></code> context in the function.</p>
<p>A sync loader that only wants to give a one value can simply <code><span class="keyword">return</span></code> it. In every other case the loader can give back any number of values with the <code><span class="keyword">this</span>.callback(err, values...)</code> function. Errors are passed to the <code><span class="keyword">this</span>.callback</code> function or thrown in a sync loader.</p>
<p>The loader is expected to give back one or two values. The first value is a resulting JavaScript code as string or buffer. The second optional value is a SourceMap as JavaScript object.</p>
<p>In the complex case, when multiple loaders are chained, only the last loader gets the resource file and only the first loader is expected to give back one or two values (JavaScript and SourceMap). Values that any other loader give back are passed to the previous loader.</p>
<h2 id="examples"><a class="anchor" href="#examples">&rarr;</a>Examples</h2>
<pre><code><span class="comment">// Identity loader</span>
module.exports = <span class="function"><span class="keyword">function</span><span class="params">(source)</span> {</span>
  <span class="keyword">return</span> source;
};</code></pre><pre><code><span class="comment">// Identity loader with SourceMap support</span>
module.exports = <span class="function"><span class="keyword">function</span><span class="params">(source, map)</span> {</span>
  <span class="keyword">this</span>.callback(<span class="literal">null</span>, source, map);
};</code></pre><h2 id="guidelines"><a class="anchor" href="#guidelines">&rarr;</a>Guidelines</h2>
<p>(Ordered by priority, first one should get the highest priority)</p>
<p>Loaders should</p>
<h3 id="do-only-a-single-task"><a class="anchor" href="#do-only-a-single-task">&rarr;</a>do only a single task</h3>
<p>Loaders can be chained. Create loaders for every step, instead of a loader that does everything at once.</p>
<p>This also means they should not convert to JavaScript if not necessary.</p>
<p>Example: Render HTML from a template file by applying the query parameters</p>
<p>I could write a loader that compiles the template from source, execute it and return a module that exports a string containing the HTML code. This is bad.</p>
<p>Instead I should write loaders for every task in this use case and apply them all (pipeline):</p>
<ul>
<li>jade-loader: Convert template to a module that exports a function.</li>
<li>apply-loader: Takes a function exporting module and returns raw result by applying query parameters.</li>
<li>html-loader: Takes HTML and exports a string exporting module.</li>
</ul>
<h3 id="generate-modules-that-are-modular"><a class="anchor" href="#generate-modules-that-are-modular">&rarr;</a>generate modules that are modular</h3>
<p>Loader generated modules should respect the same design principles like normal modules.</p>
<p>Example: That’s a bad design: (not modular, global state, …)</p>
<pre><code>require(<span class="string">"any-template-language-loader!./xyz.atl"</span>);

<span class="keyword">var</span> html = anyTemplateLanguage.render(<span class="string">"xyz"</span>);</code></pre><h3 id="flag-itself-cacheable-if-possible"><a class="anchor" href="#flag-itself-cacheable-if-possible">&rarr;</a>flag itself cacheable if possible</h3>
<p>Most loaders are cacheable, so they should flag itself as cacheable.</p>
<p>Just call <code>cacheable</code> in the loader.</p>
<pre><code><span class="comment">// Cacheable identity loader</span>
module.exports = <span class="function"><span class="keyword">function</span><span class="params">(source)</span> {</span>
    <span class="keyword">this</span>.cacheable();
    <span class="keyword">return</span> source;
};</code></pre><h3 id="not-keep-state-between-runs-and-modules"><a class="anchor" href="#not-keep-state-between-runs-and-modules">&rarr;</a>not keep state between runs and modules</h3>
<p>A loader should be independent of other modules compiled (expect of these issued by the loader).</p>
<p>A loader should be independent of previous compilations of the same module.</p>
<h3 id="mark-dependencies"><a class="anchor" href="#mark-dependencies">&rarr;</a>mark dependencies</h3>
<p>If a loader uses external resources (i. e. by reading from filesystem), they <strong>must</strong> tell about that. This information is used to invalidate cacheable loaders and recompile in watch mode.</p>
<pre><code><span class="comment">// Loader adding a header</span>
<span class="keyword">var</span> path = require(<span class="string">"path"</span>);
module.exports = <span class="function"><span class="keyword">function</span><span class="params">(source)</span> {</span>
    <span class="keyword">this</span>.cacheable();
    <span class="keyword">var</span> callback = <span class="keyword">this</span>.async();
    <span class="keyword">var</span> headerPath = path.resolve(<span class="string">"header.js"</span>);
    <span class="keyword">this</span>.addDependency(headerPath);
    fs.readFile(headerPath, <span class="string">"utf-8"</span>, <span class="function"><span class="keyword">function</span><span class="params">(err, header)</span> {</span>
        <span class="keyword">if</span>(err) <span class="keyword">return</span> callback(err);
        callback(<span class="literal">null</span>, header + <span class="string">"\n"</span> + source);
    });
};</code></pre><h3 id="resolve-dependencies"><a class="anchor" href="#resolve-dependencies">&rarr;</a>resolve dependencies</h3>
<p>In many languages there is some schema to specify dependencies. i. e. in css there is <code>@import</code> and <code>url(...)</code>. These dependencies should be resolved by the module system.</p>
<p>There are two options to do this:</p>
<ul>
<li>Transform them to <code>require</code>s.</li>
<li>Use the <code><span class="keyword">this</span>.resolve</code> function to resolve the path</li>
</ul>
<p>Example 1 css-loader: The css-loader transform dependencies to <code>require</code>s, by replacing <code>@import</code>s with a require to the other stylesheet (processed with the css-loader too) and <code>url(...)</code> with a <code>require</code> to the referenced file.</p>
<p>Example 2 less-loader: The less-loader cannot transform <code>@import</code>s to <code>require</code>s, because all less files need to be compiled in one pass to track variables and mixins. Therefore the less-loader extends the less compiler with a custom path resolving logic. This custom logic uses <code><span class="keyword">this</span>.resolve</code> to resolve the file with the configuration of the module system (aliasing, custom module directories, etc.).</p>
<p>If the language only accept relative urls (like css: <code>url(file)</code> always means <code>.<span class="regexp">/file</span></code>), there is the <code>~</code>-convention to specify references to modules:</p>
<pre><code>url(file) -&gt; require(&quot;./file&quot;)
url(~module) -&gt; require(&quot;module&quot;)</code></pre><h3 id="extract-common-code"><a class="anchor" href="#extract-common-code">&rarr;</a>extract common code</h3>
<p>don’t generate much code that is common in every module processed by that loader. Create a (runtime) file in the loader and generate a <code>require</code> to that common code.</p>
<h3 id="should-not-embed-absolute-paths"><a class="anchor" href="#should-not-embed-absolute-paths">&rarr;</a>should not embed absolute paths</h3>
<p>don’t put absolute paths in to the module code. They break hashing when the root for the project is moved. There is a method <a href="https://github.com/webpack/loader-utils#stringifyrequest"><code>stringifyRequest</code> in loader-utils</a> which converts an absolute path to an relative one.</p>
<p>Example:</p>
<pre><code>var loaderUtils = require(&quot;loader-utils&quot;);
return &quot;var runtime = require(&quot; +
  loaderUtils.stringifyRequest(this, &quot;!&quot; + require.resolve(&quot;module/runtime&quot;)) +
  &quot;);&quot;;</code></pre><h3 id="use-a-library-as-peerdependencies-when-they-wrap-it"><a class="anchor" href="#use-a-library-as-peerdependencies-when-they-wrap-it">&rarr;</a>use a library as <code>peerDependencies</code> when they wrap it</h3>
<p>using a peerDependency allows the application developer to specify the exact version in <code>package.json</code> if desired. The dependency should be relatively open to allow updating the library without needing to publish a new loader version.</p>
<pre><code><span class="string">"peerDependencies"</span>: {
    <span class="string">"library"</span>: <span class="string">"^1.3.5"</span>
}</code></pre><h3 id="programmable-objects-as-query-option"><a class="anchor" href="#programmable-objects-as-query-option">&rarr;</a>programmable objects as <code>query</code>-option</h3>
<p>there are situations where your loader requires programmable objects with functions which cannot stringified as <code>query</code>-string. The less-loader, for example, provides the possibility to specify <a href="https://github.com/webpack/less-loader#less-plugins">LESS-plugins</a>. In these cases, a loader is allowed to extend webpack’s <code>options</code>-object to retrieve that specific option. In order to avoid name collisions, however, it is important that the option is namespaced under the loader’s camelCased npm-name.</p>
<p>Example:</p>
<pre><code><span class="comment">// webpack.config.js</span>
module.exports = {
  ...
  lessLoader: {
    lessPlugins: [
      <span class="keyword">new</span> LessPluginCleanCSS({advanced: <span class="literal">true</span>})
    ]
  }
};</code></pre><p>The loader should also allow to specify the config-key (e.g. <code>lessLoader</code>) via <code>query</code>. See <a href="https://github.com/webpack/less-loader/pull/40">discussion</a> and <a href="https://github.com/webpack/less-loader/blob/39f742b4624fceae6d9cf266e9554d07a32a9c14/index.js#L49-51">example implementation</a>.</p>
<h3 id="be-added-to-the-list-of-loaders"><a class="anchor" href="#be-added-to-the-list-of-loaders">&rarr;</a>be added to the <a href="list-of-loaders.html">list of loaders</a></h3>
<h2 id="read-more"><a class="anchor" href="#read-more">&rarr;</a>Read more</h2>
<p>Read more about <a href="loaders.html">loaders</a>.</p>

						</div>
					</div>

					<div class="row">
						<div class="col-md-12">
							<div class="pull-right">
								<a href="https://github.com/webpack/docs/wiki/how-to-write-a-loader/_edit" class="wikieditlink">Edit this page</a>
							</div>
						</div>
					</div>

					<div class="row">
						<div class="col-md-12">
							<div id="disqus_thread"></div>
						</div>
					</div>
				</div>

			</div>
		</div>
		<a href="https://github.com/webpack/webpack"><img style="position: absolute; top: 0; left: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_left_orange_ff7600.png" alt="Fork me on GitHub"></a>
	</body>
</html>